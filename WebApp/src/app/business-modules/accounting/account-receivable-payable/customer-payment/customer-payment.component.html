<div class="customer-payment-wrapper m-animate-fade-in">
    <app-sub-header> </app-sub-header>
    <div class="m-content">
        <div class="m-portlet__body">
            <tabset class="custom-class-tab">
                <tab heading="Customer/Agency Payment" [active]="selectedTab === 'CUSTOMER'"
                    (selectTab)="onSelectTab('CUSTOMER')">

                    <customer-payment-form-search></customer-payment-form-search>

                    <div class="m-portlet">
                        <div class="m-portlet__body">
                            <div class="m--align-right">
                                <div class="dropdown m-dropdown m-dropdown--inline">
                                    <button class="btn btn-success dropdown-toggle" type="button"
                                        data-toggle="dropdown">
                                        <i class="la la-plus"></i>Create Receipt<span class="caret"></span>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item pointer"
                                            (click)="gotoCreateReceipt('Customer')">Customer Receipt</a>
                                        <a class="dropdown-item pointer" (click)="gotoCreateReceipt('Agency')">Agency
                                            Receipt</a>
                                    </div>
                                </div>

                            </div>
                            <tabset class="custom-class-tab">
                                <tab [active]="true">
                                    <ng-template tabHeading>
                                        <span class="m--margin-right-10">Payment</span>
                                        <ng-container *ngIf="!!totalItems">
                                            <span class="badge badge-success">{{totalItems}}</span>
                                        </ng-container>
                                    </ng-template>
                                    <div class="row">
                                        <div class="col-lg-12 ">
                                            <div class="table-wrapper table-scrollable m--margin-top-20"
                                                id="payment-table">
                                                <table class="table table-hover table-brand dataTable table-hover">
                                                    <thead app-table-header [headers]="headers"
                                                        (onClick)="sortBy($event.sortField ? $event.sortField : '')">
                                                        <th class="first table-actions-col" style="min-width:40px">
                                                        </th>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngIf="!isLoading && !CPs.length" app-table-none-record>
                                                        </tr>
                                                        <tr *ngFor="let cps of CPs; let i = index; trackBy: trackByFn"
                                                            [class.invalid-row]="cps.syncStatus === 'Rejected'"
                                                            [ngClass]="{'bg-secondary font-italic': cps.status === 'Cancel'}">
                                                            <td class="table-actions-col" style="min-width:40px">
                                                                <div class="table-actions">

                                                                    <app-permission-button type="delete"
                                                                        *ngIf="(cps.status === 'Draft')"
                                                                        (onClick)="checkAllowDelete(cps)"
                                                                        [user]="cps.userCreated" class="icon"
                                                                        icon="la la-trash text-danger">
                                                                    </app-permission-button>

                                                                    <button type="button"
                                                                        (click)="cancelReceipt(cps.id)"
                                                                        class="btn btn-icon m-btn--icon m-btn--icon-only"
                                                                        title="Cancel"
                                                                        *ngIf="(cps.status === 'Done' && cps.syncStatus !=='Synced')">
                                                                        <i class="la la-times text-danger"></i>
                                                                    </button>

                                                                </div>
                                                            </td>

                                                            <td class="text-underline">
                                                                <div *ngIf="cps.status != 'Cancel'; else CancelNo">
                                                                    <span>
                                                                        <a class="pointer"
                                                                            (click)="checkAllowDetail(cps)">{{cps.paymentRefNo}}
                                                                        </a>
                                                                    </span>
                                                                </div>
                                                                <ng-template #CancelNo>
                                                                        <a class="text-muted pointer"
                                                                        (click)="checkAllowDetail(cps)">{{cps.paymentRefNo}}
                                                                    </a>
                                                                </ng-template>
                                                            </td>

                                                            <td>
                                                                <span class="text-info">{{cps.customerName}}</span>
                                                            </td>
                                                            <td>
                                                                <span>{{cps.type}}</span>
                                                            </td>
                                                            <td class="text-right">
                                                                <span>{{cps.finalPaidAmount | number :'.0-3'}}</span>
                                                            </td>

                                                            <td>
                                                                <span>{{cps.currencyId}}</span>
                                                            </td>
                                                            <td>
                                                                <span>
                                                                    {{cps.paymentDate | date :'dd/MM/yyyy'}}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <div
                                                                    *ngIf="cps.fromDate !=null|| cps.toDate !=null; else DateNo">
                                                                    <span>{{cps.fromDate | date :'dd/MM/yyyy'}}
                                                                        -
                                                                        {{cps.toDate | date :'dd/MM/yyyy'}}</span>
                                                                </div>

                                                                <ng-template #DateNo></ng-template>
                                                            </td>
                                                            <td [ngSwitch]="cps.syncStatus">
                                                                <span *ngSwitchCase="'Synced'" class="text-success">
                                                                    {{cps.syncStatus}}</span>
                                                                <span *ngSwitchCase="'Rejected'" class="text-danger">
                                                                    {{cps.syncStatus}}</span>
                                                                <span *ngSwitchDefault>
                                                                    {{cps.syncStatus}}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span>{{cps.lastSyncDate | date :'dd/MM/yyyy' }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span>{{cps.description}}</span>
                                                            </td>

                                                            <td [ngSwitch]="cps.status">
                                                                <span *ngSwitchCase="'Draft'" class="text-danger">
                                                                    {{cps.status}}</span>
                                                                <span *ngSwitchCase="'Done'" class="text-success">
                                                                    {{cps.status}}</span>
                                                                <span *ngSwitchCase="'Cancel'" class="text-muted">
                                                                    {{cps.status}}</span>
                                                            </td>
                                                            <td>
                                                                <span
                                                                    class="text-primary">{{cps.userNameCreated}}</span>
                                                            </td>
                                                            <td>
                                                                <span>
                                                                    {{cps.datetimeCreated | date :'dd/MM/yyyy'}}
                                                                </span>
                                                            </td>

                                                            <td>
                                                                <span>
                                                                    {{cps.datetimeModified | date: 'dd/MM/yyyy'}}
                                                                </span>
                                                            </td>

                                                        </tr>
                                                        <tr class="loading-wrapper" *ngIf="isLoading"
                                                            app-table-row-loading>
                                                        </tr>

                                                    </tbody>
                                                </table>
                                            </div>
                                            <app-pagination [total]="totalItems" [pageNum]="page"
                                                [itemPerPage]="pageSize" (onChange)="updatePagingData($event)">
                                            </app-pagination>
                                        </div>
                                    </div>
                                </tab>
                                <tab heading="Summary">
                                    summary
                                </tab>
                            </tabset>
                        </div>
                    </div>
                </tab>
                <tab heading="AR Summary" (selectTab)="onSelectTab('ar')">
                </tab>
                <tab heading="Payment History" (selectTab)="onSelectTab('HISTORY')"
                    [active]="selectedTab === 'HISTORY'">
                </tab>
            </tabset>
        </div>
    </div>
</div>

<confirm-popup (onSubmit)="onConfirmDeleteCP()" [body]="messageDelete" [iconConfirm]="'la la-trash'"></confirm-popup>

<permission-403-popup></permission-403-popup>

<ng-template inject></ng-template>