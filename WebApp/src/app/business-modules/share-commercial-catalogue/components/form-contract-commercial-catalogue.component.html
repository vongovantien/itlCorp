<!--begin:: subheader-->
<div class="m-content">
    <div class="m-portlet">
        <div class="m-portlet__body">
            <div class="row">
                <div class="col-lg-11">
                    <div class="d-flex align-items-center justify-content-between p-1">
                        <h3>
                            {{isUpdate == false ? 'Create Contract Info' : 'Customer - Contract Info'}}
                        </h3>
                    </div>
                </div>
                <div class="col-lg-1" style="height: 30px">
                    <div class="h-100 d-flex align-items-center justify-content-center text-white"
                        [class.bg-danger]="!isUpdate || (!!this.selectedContract && !this.selectedContract.active) "
                        [class.bg-success]=" !!this.selectedContract && this.selectedContract.active">
                        {{!!this.selectedContract && this.selectedContract.active === true? 'Active' : 'Inactive'}}
                    </div>
                </div>
            </div>
            <hr />
            <div class="m-animate-fade-in mt-3">
                <form class="m-form m-form--state" [formGroup]="formGroup">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && !salesmanId.value}">
                                <label required>Salesman</label>
                                <app-combo-grid-virtual-scroll
                                    (itemSelected)="onSelectedDataFormInfo($event,'salesman')"
                                    [currentActiveItemId]="{ field: 'id', value: salesmanId.value}"
                                    [selectedDisplayFields]="['username']" [dataSources]="users"
                                    [displayFields]="[{field: 'username', label: 'User Name'}, { field: 'employeeNameVn', label: 'Full Name' }]"
                                    placeholder="Select Salesman" [height]="200" size="15"
                                    (remove)="resetFormControl('salesmanId')">
                                </app-combo-grid-virtual-scroll>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && !companyId.value}">
                                <label required>Company</label>
                                <app-combo-grid-virtual-scroll
                                    [currentActiveItemId]="{ field: 'id', value: companyId.value}"
                                    (itemSelected)="onSelectedDataFormInfo($event,'company')"
                                    [selectedDisplayFields]="['bunameAbbr']" [dataSources]="companies"
                                    (remove)="resetFormControl('company')"
                                    [displayFields]="[{field: 'bunameAbbr', label: 'Abbr Name'}, { field: 'bunameEn', label: 'Name EN' }]"
                                    [height]="200" placeholder="Select Company">
                                </app-combo-grid-virtual-scroll>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label>Office</label>
                                <app-combo-grid-virtual-scroll
                                    [currentActiveItemId]="{ field: 'id', value: officeId.value}"
                                    (itemSelected)="onSelectedDataFormInfo($event,'office')"
                                    [selectedDisplayFields]="['shortName']" [dataSources]="offices"
                                    (remove)="resetFormControl('office')"
                                    [displayFields]="[{field: 'shortName', label: 'Abbr Name'}, { field: 'branchNameEn', label: 'Name EN' }]"
                                    [height]="200" placeholder="Select Office">
                                </app-combo-grid-virtual-scroll>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && contractType.value[0]?.id === 'Official'}">
                                <label>Contract No</label>
                                <input type="text" class="form-control" formControlName="contractNo">
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && !effectiveDate.value}">
                                <label required for="">Effective Date</label>
                                <div class="m-input-icon m-input-icon--right down daterange-rtl">
                                    <input type="text" class="form-control m-input m-input--square" ngxDaterangepickerMd
                                        [locale]="{applyLabel: 'apply', format: 'DD/MM/YYYY'}" [singleDatePicker]="true"
                                        name="daterange" [autoApply]="true" formControlName="effectiveDate" readonly
                                        [minDate]="minDateEffective" />
                                    <span class="m-input-icon__icon m-input-icon__icon--right">
                                        <span>
                                            <i class="la la-calendar"></i>
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label>Expired Date</label>
                                <div class="m-input-icon m-input-icon--right down daterange-rtl">
                                    <input type="text" class="form-control m-input m-input--square" ngxDaterangepickerMd
                                        [locale]="{applyLabel: 'apply', format: 'DD/MM/YYYY'}" [singleDatePicker]="true"
                                        name="daterange" [autoApply]="true" formControlName="expiredDate" readonly />
                                    <span class="m-input-icon__icon m-input-icon__icon--right">
                                        <span>
                                            <i class="la la-calendar"></i>
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && contractType.invalid}">
                                <label required>Contract Type</label>
                                <ng-select #ct [items]="contractTypes" [allowClear]="true"
                                    (opened)="closeOtherSelects(ct)" formControlName="contractType"
                                    placeholder="Please select">
                                </ng-select>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="form-group"
                                [ngClass]="{'m-form__group has-danger': isSubmitted  && saleService.invalid}">
                                <label required>Sale Service</label>
                                <ng-select #sv [items]="serviceTypes" [allowClear]="true"
                                    (opened)="closeOtherSelects(sv)" formControlName="saleService"
                                    placeholder="Please select">
                                </ng-select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label>Payment Method</label>
                                <ng-select #pm [items]="paymentMethods" [allowClear]="true"
                                    (opened)="closeOtherSelects(pm)" formControlName="paymentMethod"
                                    placeholder="Please select">
                                </ng-select>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="form-group">
                                <label>Vas</label>
                                <ng-select #vas [items]="vaslst" [allowClear]="true" (opened)="closeOtherSelects(vas)"
                                    formControlName="vas" placeholder="Please select">
                                </ng-select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="alert-block__heading font-weight-bold collapse-toggle " data-toggle="collapse"
                                data-target="#data-form-contact">
                                Credit Term Info
                                <i class="la la-angle-up m--margin-right-5 float-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="row collapse show" id="data-form-contact">
                        <ng-container *ngIf="contractType.value[0]?.id !== 'Official'">
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Trial Credit Limit
                                    </label>
                                    <input type="number" class="form-control" formControlName="trialCreditLimit">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Trial Credit Days
                                    </label>
                                    <input type="number" class="form-control" formControlName="trialCreditDays">
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>Trial Effect Date
                                    </label>
                                    <div class="m-input-icon m-input-icon--right down daterange-rtl">
                                        <input type="text" class="form-control m-input m-input--square"
                                            ngxDaterangepickerMd [locale]="{applyLabel: 'apply', format: 'DD/MM/YYYY'}"
                                            [singleDatePicker]="true" name="daterange" [autoApply]="true"
                                            formControlName="trialEffectDate" readonly />
                                        <span class="m-input-icon__icon m-input-icon__icon--right">
                                            <span>
                                                <i class="la la-calendar"></i>
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>Trial Expired Date
                                    </label>
                                    <div class="m-input-icon m-input-icon--right down daterange-rtl">
                                        <input type="text" class="form-control m-input m-input--square"
                                            ngxDaterangepickerMd [locale]="{applyLabel: 'apply', format: 'DD/MM/YYYY'}"
                                            [singleDatePicker]="true" name="daterange" [autoApply]="true"
                                            formControlName="trialExpiredDate" readonly />
                                        <span class="m-input-icon__icon m-input-icon__icon--right">
                                            <span>
                                                <i class="la la-calendar"></i>
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="contractType.value[0]?.id === 'Official'">
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Payment Term</label>
                                    <input type="number" min="0" class="form-control" formControlName="paymentTerm">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Credit Limit</label>
                                    <input type="number" class="form-control" formControlName="creditLimit">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Credit Limited Rate</label>
                                    <input type="number" class="form-control" formControlName="creditLimitRate">
                                </div>
                            </div>
                        </ng-container>


                        <ng-container *ngIf="contractType.value[0]?.id !== 'Official'">
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Credit Amount</label>
                                    <input type="number" disabled class="form-control" formControlName="creditAmount">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Billing Amount</label>
                                    <input type="number" disabled class="form-control" formControlName="billingAmount">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Paid Amount</label>
                                    <input type="number" disabled class="form-control" formControlName="paidAmount">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>UnPaid Amount</label>
                                    <input type="number" disabled class="form-control" formControlName="unpaidAmount">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Customer Advance Amount</label>
                                    <input type="number" class="form-control" formControlName="customerAmount">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Credit Rate</label>
                                    <input type="number" class="form-control" formControlName="creditRate">
                                </div>
                            </div>
                        </ng-container>
                    </div>


                    <div class="row">
                        <div class="col-lg-8">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" cols="30" rows="5"
                                    formControlName="description"></textarea>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label>Contract File</label>
                                <input style="display:none" type="file" #file (change)="handleFileInput($event)">
                                <div class="form-group ">
                                    <button (click)="file.click()" type="button"
                                        class=" btn btn-success m-btn--square m-btn--icon m-btn--uppercase margin-right-10">
                                        <span>
                                            <i class="la la-plus"></i>
                                            <span>
                                                Attach Files
                                            </span>
                                        </span>
                                    </button>
                                    <ng-container *ngIf="!!fileList && !isUpdate">
                                        <span class="text-underline text-primary">
                                            {{ !!fileList.length ? fileList[0].name : null}}
                                        </span>
                                    </ng-container>
                                    <ng-container *ngIf="!isLoading && !!files && isUpdate">
                                        <a [href]="files.url" target="_blank" [title]="files.name"
                                            download>{{files.name}}</a>
                                    </ng-container>

                                </div>



                            </div>
                        </div>
                    </div>
                    <ng-container *ngIf="isUpdate">
                        <div class="row">
                            <div class="col-6">
                                Created by: <span class="text-success">{{selectedContract.userCreatedName}}</span>
                                {{selectedContract.datetimeCreated | date: 'dd/MM/yyyy HH:mm'}}
                            </div>
                            <div class="col-6">
                                Modified by: <span class="text-success">{{selectedContract.userModifiedName}}</span>
                                {{selectedContract.datetimeModified | date: 'dd/MM/yyyy HH:mm'}}
                            </div>
                        </div>
                    </ng-container>

                </form>

            </div>
        </div>
    </div>
</div>